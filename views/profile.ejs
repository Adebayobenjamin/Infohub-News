
<!doctype html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <title><%= user.email %>| profile </title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
        <link href='https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.6.95/css/materialdesignicons.css' rel='stylesheet'>
        <style>body {
background-color: #f9f9fa
}

.padding {
padding: 3rem !important
}

.user-card-full {
overflow: hidden
}

.card {
border-radius: 5px;
-webkit-box-shadow: 0 1px 20px 0 rgba(69, 90, 100, 0.08);
box-shadow: 0 1px 20px 0 rgba(69, 90, 100, 0.08);
border: none;
margin-bottom: 30px
}

.m-r-0 {
margin-right: 0px
}

.m-l-0 {
margin-left: 0px
}

.user-card-full .user-profile {
border-radius: 5px 0 0 5px
}

.bg-c-lite-green {
background: -webkit-gradient(linear, left top, right top, from(#f29263), to(#ee5a6f));
background: linear-gradient(to right, #ee5a6f, #f29263)
}

.user-profile {
padding: 20px 0
}

.card-block {
padding: 1.25rem
}

.m-b-25 {
margin-bottom: 25px
}

.img-radius {
border-radius: 5px
}

h6 {
font-size: 14px
}

.card .card-block p {
line-height: 25px
}

@media only screen and (min-width: 1400px) {
p {
font-size: 14px
}
}

.card-block {
padding: 1.25rem
}

.b-b-default {
border-bottom: 1px solid #e0e0e0
}

.m-b-20 {
margin-bottom: 20px
}

.p-b-5 {
padding-bottom: 5px !important
}

.card .card-block p {
line-height: 25px
}

.m-b-10 {
margin-bottom: 10px
}

.text-muted {
color: #919aa3 !important
}

.b-b-default {
border-bottom: 1px solid #e0e0e0
}

.f-w-600 {
font-weight: 600
}

.m-b-20 {
margin-bottom: 20px
}

.m-t-40 {
margin-top: 20px
}

.p-b-5 {
padding-bottom: 5px !important
}

.m-b-10 {
margin-bottom: 10px
}

.m-t-40 {
margin-top: 20px
}

.user-card-full .social-link li {
display: inline-block
}

.user-card-full .social-link li a {
font-size: 20px;
margin: 0 10px 0 0;
-webkit-transition: all 0.3s ease-in-out;
transition: all 0.3s ease-in-out
}
.err{
color: rgba(236, 104, 104, 0.938);
}
</style>
        <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
       <!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    </head>
    <nav class="navbar navbar-dark bg-dark ">
        <div class="container-fluid">
          <a class="navbar-brand text-white" href="#"><%= user.email %> </a>
          
          <a class="nav-link text-white" aria-current="page" href="/">Home</a>
          <a class="nav-link text-white" aria-current="page" href="/logout">Logout</a>
               
          </div>
        </div>
      </nav>
<!-- update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModal" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="updateModal">Update Details</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
<form id="form">
<div class="mb-3">
<label for="exampleInputEmail1" class="form-label">Email address</label>
<input type="email" class="form-control" id="inputemail" aria-describedby="emailHelp" name="email">
<div id="emailHelp" class="form-text err email">We'll never share your email with anyone else.</div>
</div>
<div class="mb-3">
<label for="exampleInputPassword1" class="form-label">Password</label>
<input type="password" class="form-control" id="exampleInputPassword1" name="password">
<div class=" form-text err password"></div>
</div>
<div class="mb-3 form-check">
<div class="form-field">
<div class="form-check">
<h4>Select Favourites</h4>
<input class="form-check-input" type="checkbox" value="technology"  name="favourites">  Technology <br>
<input class="form-check-input" type="checkbox" value="entertainment"  name="favourites"> Entertainment<br>
<input class="form-check-input" type="checkbox" value="business"  name="favourites"> Business<br>
<input class="form-check-input" type="checkbox" value="sport"  name="favourites">  Sport <br>
<input class="form-check-input" type="checkbox" value="science" name="favourites"> Science

</div>
</div>
</div>
<button type="submit" class="btn btn-primary" id="submit">Submit</button>
</form>

</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModal" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-body">
<h3 class="text-danger">Are you sure you want to delete your Account ?</h3>
<a href="" class="btn btn-danger" id="delete" data-id = "<%= user._id %> ">Delete</a>

</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

</div>
</div>
</div>
</div>

    <div class="page-content page-container" id="page-content">
<div class="padding">
<div class="row container d-flex justify-content-center">
<div class="col-xl-6 col-md-12">
<div class="card user-card-full">
<div class="row m-l-0 m-r-0">
<div class="col-sm-4 bg-c-lite-green user-profile">
    <div class="card-block text-center text-white">
        <div class="m-b-25"> <img src="https://img.icons8.com/bubbles/100/000000/user.png" class="img-radius" alt="User-Profile-Image"> </div>
        <h6 class="f-w-600"><%= user.email %> </h6>
       <i class=" mdi mdi-square-edit-outline feather icon-edit m-t-10 f-16"></i>
    </div>
</div>
<div class="col-sm-8">
    <div class="card-block">
        <h6 class="m-b-20 p-b-5 b-b-default f-w-600">Information</h6>
        <div class="row">
            <div class="col-sm-6">
                <p class="m-b-10 f-w-600">Email</p>
                <h6 class="text-muted f-w-400" id="useremail"><%= user.email %> </h6>
            </div>
           
        </div>
        <h6 class="m-b-20 m-t-40 p-b-5 b-b-default f-w-600">Favourites</h6>
        <div class="row">
            <% for(i=0; i< user.userFavourites.length; i++){ const favourites = user.userFavourites[i] %> 
            <div class="col-sm-6">
                <h6 class="text-muted f-w-400"><%= favourites %> </h6>
            </div>
            <% } %> 
        </div>
        <ul class="social-link list-unstyled m-t-40 m-b-10">
            <li style="margin-bottom: 20px;">
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#updateModal" id="updateBtn">
                   Update profile
                  </button></li>
            <li>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                    Delete profile
                  </button></li>
           
        </ul>
    </div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script>
// when update button is clicked, set email as input value
const updateBtn = document.getElementById('updateBtn');
updateBtn.addEventListener('click', (e)=> {
const email = document.getElementById('useremail').innerText;
const emailInput = document.getElementById('inputemail');
emailInput.value = email;
})
const form = document.getElementById('form');

// add submit event to form
form.addEventListener('submit', (e)=>{

e.preventDefault();

const email = form.email.value;
const password = form.password.value;
const favourites = document.querySelectorAll(`input[name="favourites"]:checked`);
let values = [];
favourites.forEach(favourite=>{
values.push(favourite.value)
});

const emailError = document.querySelector('.err.email');
const passwordError = document.querySelector('.err.password');
emailError.textContent = '';
passwordError.textContent = '';
const submitBtn = document.getElementById('submit');
const formData = {
email,
password,
userFavourites: values
}
// create loader
submitBtn.innerHTML = "Updating....";
fetch('/profile', {
method: "PUT",
body: JSON.stringify(formData),
headers: {"Content-Type": "application/json"}
}).then(response=>{
response.json().then(data=>{
submitBtn.innerHTML = "SUBMIT"
if(data.user){
location.assign('/profile')
}
if(data.errors){
emailError.textContent = data.errors.email;
passwordError.textContent = data.errors.password
}

}
)
}).catch(err=> console.log(err))

});

const deletebtn = document.getElementById('delete');
deletebtn.addEventListener('click', (e)=>{
const id = deletebtn.dataset.id;
e.preventDefault();
fetch(`/delete/${id}`, {
method: "DELETE"
}).then(response=>{
response.json().
then(data=>{
location.assign(data.location);
})
})
.catch(err=>{
console.log(err.message)
})
});
</script>
    </body>
</html>